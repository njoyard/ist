/**
 * IST: Indented Selector Templating
 * version 0.6.6
 *
 * Copyright (c) 2012-2014 Nicolas Joyard
 * Released under the MIT license.
 *
 * Author: Nicolas Joyard <joyard.nicolas@gmail.com>
 * http://njoyard.github.com/ist
 */

!function(e){var t="function"==typeof e.define&&e.define.amd,n="undefined"!=typeof process&&process.versions&&!!process.versions.node,r="undefined"!=typeof window&&window.navigator&&window.document,i={jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},findScript:function(e){var t,n,r,i,o;try{o=document.querySelectorAll("script#"+e)}catch(c){return}if(o)for(t=0,n=o.length;n>t;t++)if(r=o[t],"text/x-ist"===r.getAttribute("type"))return r.innerHTML;return i},iterateNodelist:function(e,t,n){for(var r,i=e,o=t?t.nextSibling:null;i&&i!==o;)r=i.nextSibling,n(i),i=r},buildNodelist:function(e,t){var n=[];return this.iterateNodelist(e,t,function(e){n.push(e)}),n},removeNodelist:function(e,t){this.iterateNodelist(e,t,function(e){e.parentNode.removeChild(e)})}},o=function(e){var t,n=/{{\s*((?:}(?!})|[^}])*?)\s*}}/,r="",i="",o={},c={};t=i.length&&r.length?function(e){return Array.isArray(e)?e.map(t):i+e.split(r).join(r+i)}:function(e){return e};var s={evaluate:function(e){var t="{{ "+e+" }}";if(!(t in o)){var n=[i+"if(this!==null&&this!==undefined){",i+i+"with(this){with(ist$s){return "+e+";}}",i+"}else{",i+i+"with(ist$s){return "+e+";}",i+"}"].join(r),c="document,ist$s";new Function(c,n),o[t]=["ist$x.call(function("+c+"){",n,"})"].join(r)}return o[t]},interpolate:function(t){return t in o||(o[t]=n.test(t)?s.evaluate(t.split(n).map(function(t,n){return n%2?"("+t+")":"'"+e.jsEscape(t)+"'"}).filter(function(e){return"''"!==e}).join("+")):"'"+e.jsEscape(t)+"'"),o[t]},property:function(e){var n=e.join(".");return n in c||(c[n]=["function(ist$t,ist$v) {",i+"var ist$c = ist$t;"].concat(t(e.map(function(t,n){return n===e.length-1?'ist$c["'+t+'"] = ist$v;':'ist$c = ist$c["'+t+'"] = ist$c["'+t+'"] || {};'}))).concat(["}"]).join(r)),c[n]},line:function(e){return"ist$i = "+e.line+";"},element:function(e){var t=e.attributes||{},n=e.properties||[],o=e.events||{};return[s.line(e)].concat(Object.keys(t).map(function(e){return["ist$n.setAttribute(",i+'"'+e+'",',i+'"" + '+s.interpolate(t[e]),");"].join(r)})).concat(n.map(function(e){return"("+s.property(e.path)+")(ist$n, "+s.interpolate(e.value)+");"})).concat(["ist$n.ist$handlers = ist$n.ist$handlers || {};","Object.keys(ist$n.ist$handlers).forEach(function(evt) {",i+"ist$n.removeEventListener(evt, ist$n.ist$handlers[evt], false);",i+"delete ist$n.ist$handlers[evt];","});"]).concat(Object.keys(o).map(function(e){return['ist$n.ist$handlers["'+e+'"] = '+s.evaluate(o[e])+";"].join(r)})).concat(["Object.keys(ist$n.ist$handlers).forEach(function(evt) {",i+"ist$n.addEventListener(evt, ist$n.ist$handlers[evt], false);","});"]).join(r)},text:function(e){return[s.line(e),'ist$n.textContent = "" + '+s.interpolate(e.text)+";"].join(r)},directive:function(e){var t=e.expr?s.evaluate(e.expr):"undefined";return[s.line(e),'if (!("keys" in ist$n)) {',i+"ist$n.keys = [];",i+"ist$n.fragments = [];","} else {",i+"ist$n.remove(ist$l);","}",'if (!ist$d.has("'+e.directive+'")) {',i+'throw new Error("No directive helper for @'+e.directive+' has been registered");',"}",'ist$d.get("'+e.directive+'")(ist$x, '+t+", ist$n.template, ist$n.iterator);","ist$n = ist$n.last() || ist$n;"].join(r)},children:function(e){return["(function(ist$l) {"].concat(t(e)).concat(["})([].slice.call(ist$n.childNodes));"]).join(r)},next:function(){return["ist$n = ist$l.shift();"].join(r)},wrap:function(e){return["var ist$n;","var ist$i;","try {"].concat(t(e)).concat([i+"return ist$n;","} catch(e) {",i+"throw ist$e(e, ist$i);","}"]).join(r)},compile:function(e){return new Function("ist$e,ist$d,ist$x,ist$l",Array.isArray(e)?e.join(r):e)}};return s}(i),c=function(e){function t(t,n,r){var i=t.keys,o=t.fragments;"function"==typeof n&&(r=n,n=["nokey"]);for(var c=0;c<i.length;c++)if(-1===n.indexOf(i[c])){var s=o[c];e.removeNodelist(s.firstChild,s.lastChild),i.splice(c,1),o.splice(c,1),c--}var u=t;n.forEach(function(t,n){var c,s,a,l,f=i.indexOf(t),d=!1;if(-1!==f){s=o[f];var p=s.firstChild;p&&p.previousSibling!==u&&(a=u.nextSibling,e.iterateNodelist(p,s.lastChild,function(e){u.parentNode.insertBefore(e,a)})),l=s.rendered,l&&(l.clear=function(){e.removeNodelist(s.firstChild,s.lastChild),s.firstChild=s.lastChild=null},l.reclaim=function(t){e.iterateNodelist(s.firstChild,s.lastChild,function(e){t.appendChild(e)})})}else s={};if(c=r(t,l),f!==n&&(-1!==f&&(i.splice(f,1),o.splice(f,1)),i.splice(n,0,t),o.splice(n,0,s)),c){if(!("nodeType"in c))throw new Error("Helper iterator callback returned unknown result");l&&c!==l&&l.clear(),d=!0,l=c}l?(l.nodeType===l.DOCUMENT_FRAGMENT_NODE?(s.firstChild="function"==typeof l._first?l._first():l.firstChild,s.lastChild="function"==typeof l._last?l._last():l.lastChild):s.firstChild=s.lastChild=l,s.rendered=l,d&&(a=u.nextSibling,e.iterateNodelist(s.firstChild,s.lastChild,function(e){u.parentNode.insertBefore(e,a)}))):(delete s.rendered,s.firstChild=s.lastChild=null),u=s.firstChild||u})}return t.remove=function(t,n){var r=t.fragments;r&&r.forEach(function(t){e.iterateNodelist(t.firstChild,t.lastChild,function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)})})},t.last=function(e){var t=e.fragments;if(t&&t.length)for(var n=t.length-1;n>=0;n--)if(t[n].lastChild)return t[n].lastChild},t}(i),s=function(e){function t(e,n){this.value=e,this.values=[e],this.doc=n||document,this.rootScope=this.scope=t.globalScope}return t.globalScope={},t.prototype={clonePrerendered:function(t){var n=this.importNode(t,!1);t.nodeType===t.COMMENT_NODE&&(n.iterator=function(t,r){return e(n,t,r)},n.last=function(){return e.last(n)},n.remove=function(t){return e.remove(n,t)},n.template=t.template);var r=this;return t.childNodes&&[].slice.call(t.childNodes).forEach(function(e){n.appendChild(r.clonePrerendered(e))}),n},importNode:function(e,t){return e.ownerDocument===this.doc?e.cloneNode(t):this.doc.importNode(e,t)},createDocumentFragment:function(){return this.doc.createDocumentFragment()},createElement:function(e,t){return"undefined"!=typeof t?this.doc.createElementNS(t,e):this.doc.createElement(e)},createTextNode:function(e){return this.doc.createTextNode(e)},createComment:function(e){return this.doc.createComment(e)},pushScope:function(e){var t=Object.create(this.scope);Object.keys(e).forEach(function(n){t[n]=e[n]}),this.scope=t},popScope:function(){var e=this.scope;if(e===this.rootScope)throw new Error("No scope left to pop out");this.scope=Object.getPrototypeOf(e)},pushValue:function(e){this.values.unshift(e),this.value=e,this.pushScope(void 0!==e&&null!==e&&"string"!=typeof e&&"number"!=typeof e?e:{})},popValue:function(){this.popScope(),this.values.shift(),this.value=this.values[0]},createContext:function(e){return new t(e,this.doc)},call:function(e){return e.call(this.value,this.doc,this.scope)}},t}(c),u=function(){function e(e,t,n,r){r(t?["conditional"]:[],function(t,r){return r?void r.update(e):n.render(e)})}function t(e,t,n,r,i,o){var c=e.value;o(n,function(o,s){var u=n.indexOf(o),a=t[n.indexOf(o)];e.pushValue(a);var l={first:0===u,index:u,last:u==t.length-1,length:t.length,outer:c};return r&&Object.keys(r).forEach(function(e){l[e]=r[e]}),e.pushScope({loop:l}),s?s.update(e):s=i.render(e),e.popScope(),e.popValue(),s})}var n,r,i={};return r={"if":function(t,n,r,i){e(t,n,r,i)},unless:function(t,n,r,i){e(t,!n,r,i)},"with":function(e,t,n,r){r(function(r,i){return e.pushValue(t),i?i.update(e):i=n.render(e),e.popValue(),i})},each:function(e,n,r,i){if(!Array.isArray(n))throw new Error(n+" is not an array");t(e,n,n,null,r,i)},eachkey:function(e,n,r,i){var o=Object.keys(n),c=o.map(function(e){return{key:e,value:n[e]}});t(e,c,o,{object:n},r,i)},dom:function(e,t,n,r){r(function(){return t.ownerDocument!==e.doc&&(t=e.doc.importNode(t,!0)),t})},define:function(e,t,n){i[t]=n},use:function(e,t,n,r){if(!(t in i))throw new Error("Template '"+t+"' has not been @defined");r(function(n,r){return r?void r.update(e):i[t].render(e)})}},n={register:function(e,t){r[e]=t},has:function(e){return e in r&&"function"==typeof r[e]},get:function(e){return r[e]}}}(),a=function(e,t,n,r){function i(e,t){var n,r,o,c=t.filter(function(t){return t.partial===e});if(c.length)return c[0];for(r=0,o=t.length;o>r;r++)if("undefined"!=typeof t[r].children&&(n=i(e,t[r].children)))return n}function o(t,n){this.name=t||"<unknown>",this.nodes=n,"undefined"!=typeof document&&(this.pre=document.createDocumentFragment(),this.update=e.compile(this._preRenderTree(n,this.pre)))}var c=/{{((?:}(?!})|[^}])*)}}/;return o.prototype._preRenderTree=function(t,n){var r=[],i=this;return t.forEach(function(t){var s;r.push(e.next());try{"tagName"in t?(s=document.createElement(t.tagName),(t.classes||[]).forEach(function(e){s.classList.add(e)}),"undefined"!=typeof t.id&&(s.id=t.id),r.push(e.element(t)),t.children&&t.children.length&&(r=r.concat(e.children(i._preRenderTree(t.children,s))))):"text"in t?(s=document.createTextNode(t.text),c.test(t.text)&&r.push(e.text(t))):"directive"in t&&(s=document.createComment("@"+t.directive+" "+t.expr+" ("+i.name+":"+t.line+")"),t.children&&t.children.length&&(s.template=new o(i.name,t.children)),r.push(e.directive(t))),n.appendChild(s)}catch(u){throw i._completeError(u,t.line)}}),e.wrap(r)},o.prototype.findPartial=function(e){return console&&(console.warn||console.log)("Warning: Template#findPartial is deprecated, use Template#partial instead"),this.partial(e)},o.prototype.partial=function(e){var t;if("undefined"!=typeof e)return t=i(e,this.nodes),t?new o(this.name,[t]):void 0},o.prototype._completeError=function(e,t){var n="in '"+this.name+"' on line "+(t||"<unknown>");return"undefined"==typeof e.istStack&&(e.message+=" "+n,e.istStack=[]),e.istStack.push(n),e},o.prototype.render=function(e,i){function o(e,n){return e instanceof t?e:new t(e,n||document)}var c=this;e=o(e,i);var s=e.clonePrerendered(this.pre),u=s.firstChild,a=s.lastChild;return s.update=function(t){t=o(t||e),a=c.update(function(e,t){return c._completeError(e,t)},n,t,r.buildNodelist(u,a))},s._first=function(){return u},s._last=function(){return a},s.update(e),s},o}(o,s,u,i),l=function(){var e,t,n,r="U",i="I",o="D",c={};return e=function(){return{text:this.text,line:this.line}},t=function(){var e={tagName:this.tagName,line:this.line};return"undefined"!=typeof this.id&&(e.id=this.id),"undefined"!=typeof this.classes&&this.classes.length>0&&(e.classes=this.classes),"undefined"!=typeof this.attributes&&Object.keys(this.attributes).length>0&&(e.attributes=this.attributes),"undefined"!=typeof this.properties&&this.properties.length>0&&(e.properties=this.properties),"undefined"!=typeof this.events&&Object.keys(this.events).length>0&&(e.events=this.events),"undefined"!=typeof this.children&&this.children.length>0&&(e.children=this.children),"undefined"!=typeof this.partial&&(e.partial=this.partial),e},n=function(){var e={directive:this.directive,expr:this.expr,line:this.line};return"undefined"!=typeof this.children&&this.children.length>0&&(e.children=this.children),e},c.generateNodeTree=function(e,t){var n,i,c,s,u={children:[]},a=[u],l=0;if(!e)return u.children;for(i=function(){return a[a.length-1]},c=function(e){l++,a.push(e)},s=function(){var e,t,n;if(a.length<2)throw new Error("Could not pop node from stack");if(e=a.pop(),t=i(),"undefined"!=typeof t.text)throw n=new Error("Cannot add children to text node"),n.line=e.line,n;if("else"===e.directive){var r=t.children[t.children.length-1];if(r&&!r.wasElse&&"if"===r.directive)e.directive="unless";else{if(!r||r.wasElse||"unless"!==r.directive)throw n=new Error("@else directive has no matching @if or @unless directive"),n.line=e.line,n;e.directive="if"}e.expr=r.expr,e.wasElse=!0}return t.children.push(e),e},n=t.map(function(e){return e.pop()}),n.unshift(e),n.forEach(function(e){var t=e.indent,n=e.item;if(t[0]instanceof Error)throw t[0];if(l>0)if(t[0]===r)s();else if(t[0]===o)for(s();t.length>0;)t.pop(),s();c(n)});a.length>1;)s();return u.children},c.parseIndent=function(e,t,n){var c,s=t.length,u=[];if(0===s.length&&e.push(s),s==e[0])return[r];if(s>e[0])return e.unshift(s),[i];for(;s<e[0];)e.shift(),u.push(o);return s!=e[0]?(c=new Error("Unexpected indent"),c.line=n,c.column=1,[c]):u},c.createTextNode=function(t,n){return{text:t,line:n,toJSON:e}},c.createElement=function(e,n,r,i){var o={tagName:e,line:i,classes:[],attributes:{},properties:[],events:{},children:[],toJSON:t};return n.forEach(function(e){"undefined"!=typeof e.id?o.id=e.id:"undefined"!=typeof e.className?o.classes.push(e.className):"undefined"!=typeof e.attr?o.attributes[e.attr]=e.value:"undefined"!=typeof e.prop?o.properties.push({path:e.prop,value:e.value}):"undefined"!=typeof e.event&&("undefined"==typeof o.events[e.event]&&(o.events[e.event]=[]),o.events[e.event].push(e.value))}),"undefined"!=typeof r&&(r.partial&&(o.partial=r.partial),r.textnode&&"undefined"!=typeof r.textnode.text&&o.children.push(r.textnode)),o},c.createDirective=function(e,t,r){return{directive:e,expr:t,line:r,children:[],toJSON:n}},c.escapedCharacter=function(e){return e.length>1?String.fromCharCode(parseInt(e,16)):{f:"\f",b:"\b",t:"	",n:"\n",r:"\r"}[e]||e},c}(),f=function(e){var t;return t=function(){function t(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function n(e,t,n,r,i,o){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}function r(t){function r(){return i(hn).line}function i(e){function n(e,n,r){var i,o;for(i=n;r>i;i++)o=t.charAt(i),"\n"===o?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return vn!==e&&(vn>e&&(vn=0,mn={line:1,column:1,seenCR:!1}),n(mn,vn,e),vn=e),mn}function o(e){gn>pn||(pn>gn&&(gn=pn,yn=[]),yn.push(e))}function c(e,r,o){function c(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function s(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,o,c=new Array(e.length);for(o=0;o<e.length;o++)c[o]=e[o].description;return r=e.length>1?c.slice(0,-1).join(", ")+" or "+c[e.length-1]:c[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var u=i(o),a=o<t.length?t.charAt(o):null;return null!==r&&c(r),new n(null!==e?e:s(r,a),r,a,o,u.line,u.column)}function s(){var e,t,n,r,i,o,c;for(e=pn,t=[],n=f();n!==L;)t.push(n),n=f();if(t!==L)if(n=a(),n===L&&(n=U),n!==L){if(r=[],i=pn,o=[],c=f(),c!==L)for(;c!==L;)o.push(c),c=f();else o=M;for(o!==L?(c=a(),c!==L?(o=[o,c],i=o):(pn=i,i=M)):(pn=i,i=M);i!==L;){if(r.push(i),i=pn,o=[],c=f(),c!==L)for(;c!==L;)o.push(c),c=f();else o=M;o!==L?(c=a(),c!==L?(o=[o,c],i=o):(pn=i,i=M)):(pn=i,i=M)}if(r!==L){for(i=[],o=f();o!==L;)i.push(o),o=f();i!==L?(hn=e,t=V(n,r),e=t):(pn=e,e=M)}else pn=e,e=M}else pn=e,e=M;else pn=e,e=M;return e}function u(){var e,n;return Cn++,I.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=L,0===Cn&&o(W)),Cn--,e===L&&(n=L,0===Cn&&o(B)),e}function a(){var e,t,n,r,i;if(e=pn,t=l(),t!==L)if(n=$(),n===L&&(n=S(),n===L&&(n=R())),n!==L){for(r=[],i=u();i!==L;)r.push(i),i=u();r!==L?(hn=e,t=G(t,n),e=t):(pn=e,e=M)}else pn=e,e=M;else pn=e,e=M;return e}function l(){var e,t,n;for(Cn++,e=pn,t=[],n=u();n!==L;)t.push(n),n=u();return t!==L&&(hn=e,t=K(t)),e=t,Cn--,e===L&&(t=L,0===Cn&&o(X)),e}function f(){var e,n;return Cn++,10===t.charCodeAt(pn)?(e=Y,pn++):(e=L,0===Cn&&o(Z)),Cn--,e===L&&(n=L,0===Cn&&o(Q)),e}function d(){var e,n;return Cn++,tt.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=L,0===Cn&&o(nt)),Cn--,e===L&&(n=L,0===Cn&&o(et)),e}function p(){var e,n,r,i;if(Cn++,e=pn,it.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=L,0===Cn&&o(ot)),n!==L){for(r=[],ct.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(st));i!==L;)r.push(i),ct.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(st));r!==L?(hn=e,n=ut(n,r),e=n):(pn=e,e=M)}else pn=e,e=M;return Cn--,e===L&&(n=L,0===Cn&&o(rt)),e}function h(){var e,n,r,i,c,s;if(Cn++,e=pn,n=p(),n!==L){for(r=[],i=pn,46===t.charCodeAt(pn)?(c=lt,pn++):(c=L,0===Cn&&o(ft)),c!==L?(s=p(),s!==L?(c=[c,s],i=c):(pn=i,i=M)):(pn=i,i=M);i!==L;)r.push(i),i=pn,46===t.charCodeAt(pn)?(c=lt,pn++):(c=L,0===Cn&&o(ft)),c!==L?(s=p(),s!==L?(c=[c,s],i=c):(pn=i,i=M)):(pn=i,i=M);r!==L?(hn=e,n=dt(n,r),e=n):(pn=e,e=M)}else pn=e,e=M;return Cn--,e===L&&(n=L,0===Cn&&o(at)),e}function v(){var e,n,r;return e=pn,33===t.charCodeAt(pn)?(n=pt,pn++):(n=L,0===Cn&&o(ht)),n!==L?(r=p(),r!==L?(hn=e,n=vt(r),e=n):(pn=e,e=M)):(pn=e,e=M),e}function m(){var e,n,r;return e=pn,35===t.charCodeAt(pn)?(n=mt,pn++):(n=L,0===Cn&&o(gt)),n!==L?(r=p(),r!==L?(hn=e,n=yt(r),e=n):(pn=e,e=M)):(pn=e,e=M),e}function g(){var e,n,r;return e=pn,46===t.charCodeAt(pn)?(n=lt,pn++):(n=L,0===Cn&&o(ft)),n!==L?(r=p(),r!==L?(hn=e,n=Ct(r),e=n):(pn=e,e=M)):(pn=e,e=M),e}function y(){var e,n,r;for(e=pn,n=[],r=T(),r===L&&(xt.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=L,0===Cn&&o(At)));r!==L;)n.push(r),r=T(),r===L&&(xt.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=L,0===Cn&&o(At)));return n!==L&&(hn=e,n=wt(n)),e=n}function C(){var e,n,r,i,c,s;return e=pn,91===t.charCodeAt(pn)?(n=$t,pn++):(n=L,0===Cn&&o(Et)),n!==L?(r=p(),r!==L?(61===t.charCodeAt(pn)?(i=Nt,pn++):(i=L,0===Cn&&o(bt)),i!==L?(c=y(),c!==L?(93===t.charCodeAt(pn)?(s=St,pn++):(s=L,0===Cn&&o(jt)),s!==L?(hn=e,n=Ot(r,c),e=n):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M),e}function x(){var e,n,r,i,c,s,u;return e=pn,91===t.charCodeAt(pn)?(n=$t,pn++):(n=L,0===Cn&&o(Et)),n!==L?(46===t.charCodeAt(pn)?(r=lt,pn++):(r=L,0===Cn&&o(ft)),r!==L?(i=h(),i!==L?(61===t.charCodeAt(pn)?(c=Nt,pn++):(c=L,0===Cn&&o(bt)),c!==L?(s=y(),s!==L?(93===t.charCodeAt(pn)?(u=St,pn++):(u=L,0===Cn&&o(jt)),u!==L?(hn=e,n=Tt(i,s),e=n):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M),e}function A(){var e,n,r,i,c,s,u;return e=pn,91===t.charCodeAt(pn)?(n=$t,pn++):(n=L,0===Cn&&o(Et)),n!==L?(33===t.charCodeAt(pn)?(r=pt,pn++):(r=L,0===Cn&&o(ht)),r!==L?(i=p(),i!==L?(61===t.charCodeAt(pn)?(c=Nt,pn++):(c=L,0===Cn&&o(bt)),c!==L?(s=y(),s!==L?(93===t.charCodeAt(pn)?(u=St,pn++):(u=L,0===Cn&&o(jt)),u!==L?(hn=e,n=kt(i,s),e=n):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M),e}function w(){var e,t;return Cn++,e=m(),e===L&&(e=g(),e===L&&(e=C(),e===L&&(e=x(),e===L&&(e=A())))),Cn--,e===L&&(t=L,0===Cn&&o(_t)),e}function $(){var e,t;return Cn++,e=E(),e===L&&(e=N()),Cn--,e===L&&(t=L,0===Cn&&o(Ft)),e}function E(){var e,t,n;if(e=pn,t=[],n=w(),n!==L)for(;n!==L;)t.push(n),n=w();else t=M;return t!==L?(n=b(),n!==L?(hn=e,t=Rt(t,n),e=t):(pn=e,e=M)):(pn=e,e=M),e}function N(){var e,t,n,r;if(e=pn,t=p(),t!==L){for(n=[],r=w();r!==L;)n.push(r),r=w();n!==L?(r=b(),r!==L?(hn=e,t=Dt(t,n,r),e=t):(pn=e,e=M)):(pn=e,e=M)}else pn=e,e=M;return e}function b(){var e,t,n,r,i;if(e=pn,t=pn,n=[],r=u(),r!==L)for(;r!==L;)n.push(r),r=u();else n=M;if(n!==L?(r=S(),r!==L?(hn=t,n=zt(r),t=n):(pn=t,t=M)):(pn=t,t=M),t===L&&(t=U),t!==L){if(n=pn,r=[],i=u(),i!==L)for(;i!==L;)r.push(i),i=u();else r=M;r!==L?(i=v(),i!==L?(hn=n,r=Pt(i),n=r):(pn=n,n=M)):(pn=n,n=M),n===L&&(n=U),n!==L?(hn=e,t=qt(t,n),e=t):(pn=e,e=M)}else pn=e,e=M;return e}function S(){var e,t;return Cn++,e=pn,t=F(),t!==L&&(hn=e,t=Ht(t)),e=t,Cn--,e===L&&(t=L,0===Cn&&o(Lt)),e}function j(){var e,n,r,i,c,s;return e=pn,117===t.charCodeAt(pn)?(n=Jt,pn++):(n=L,0===Cn&&o(Mt)),n!==L?(Ut.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=L,0===Cn&&o(Vt)),r!==L?(Ut.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(Vt)),i!==L?(Ut.test(t.charAt(pn))?(c=t.charAt(pn),pn++):(c=L,0===Cn&&o(Vt)),c!==L?(Ut.test(t.charAt(pn))?(s=t.charAt(pn),pn++):(s=L,0===Cn&&o(Vt)),s!==L?(hn=e,n=Bt(r,i,c,s),e=n):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M),e}function O(){var e,n,r,i;return e=pn,120===t.charCodeAt(pn)?(n=It,pn++):(n=L,0===Cn&&o(Wt)),n!==L?(Ut.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=L,0===Cn&&o(Vt)),r!==L?(Ut.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(Vt)),i!==L?(hn=e,n=Gt(r,i),e=n):(pn=e,e=M)):(pn=e,e=M)):(pn=e,e=M),e}function T(){var e,n,r;return e=pn,92===t.charCodeAt(pn)?(n=Xt,pn++):(n=L,0===Cn&&o(Kt)),n!==L?(r=j(),r===L&&(r=O(),r===L&&(r=d())),r!==L?(hn=e,n=Qt(r),e=n):(pn=e,e=M)):(pn=e,e=M),e}function k(){var e,n,r,i;if(e=pn,34===t.charCodeAt(pn)?(n=Yt,pn++):(n=L,0===Cn&&o(Zt)),n!==L){for(r=[],i=T(),i===L&&(en.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(tn)));i!==L;)r.push(i),i=T(),i===L&&(en.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(tn)));r!==L?(34===t.charCodeAt(pn)?(i=Yt,pn++):(i=L,0===Cn&&o(Zt)),i!==L?(hn=e,n=wt(r),e=n):(pn=e,e=M)):(pn=e,e=M)}else pn=e,e=M;return e}function _(){var e,n,r,i;if(e=pn,39===t.charCodeAt(pn)?(n=nn,pn++):(n=L,0===Cn&&o(rn)),n!==L){for(r=[],i=T(),i===L&&(on.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(cn)));i!==L;)r.push(i),i=T(),i===L&&(on.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=L,0===Cn&&o(cn)));r!==L?(39===t.charCodeAt(pn)?(i=nn,pn++):(i=L,0===Cn&&o(rn)),i!==L?(hn=e,n=wt(r),e=n):(pn=e,e=M)):(pn=e,e=M)}else pn=e,e=M;return e}function F(){var e,t;return Cn++,e=k(),e===L&&(e=_()),Cn--,e===L&&(t=L,0===Cn&&o(sn)),e}function R(){var e,t;return Cn++,e=z(),e===L&&(e=D()),Cn--,e===L&&(t=L,0===Cn&&o(un)),e}function D(){var e,n,r;return e=pn,64===t.charCodeAt(pn)?(n=an,pn++):(n=L,0===Cn&&o(ln)),n!==L?(r=p(),r!==L?(hn=e,n=fn(r),e=n):(pn=e,e=M)):(pn=e,e=M),e}function z(){var e,n,r,i,c,s;if(e=pn,64===t.charCodeAt(pn)?(n=an,pn++):(n=L,0===Cn&&o(ln)),n!==L)if(r=p(),r!==L){if(i=[],c=u(),c!==L)for(;c!==L;)i.push(c),c=u();else i=M;if(i!==L){if(c=[],s=d(),s!==L)for(;s!==L;)c.push(s),s=d();else c=M;c!==L?(hn=e,n=dn(r,c),e=n):(pn=e,e=M)}else pn=e,e=M}else pn=e,e=M;else pn=e,e=M;return e}var P,q=arguments.length>1?arguments[1]:{},L={},H={templateLines:s},J=s,M=L,U=null,V=function(t,n){return e.generateNodeTree(t,n)},B={type:"other",description:"whitespace"},I=/^[ \t]/,W={type:"class",value:"[ \\t]",description:"[ \\t]"},G=function(e,t){return{indent:e,item:t}},X={type:"other",description:"indent"},K=function(t){return e.parseIndent(xn,t,r())},Q={type:"other",description:"new line"},Y="\n",Z={type:"literal",value:"\n",description:'"\\n"'},et={type:"other",description:"character"},tt=/^[^\n]/,nt={type:"class",value:"[^\\n]",description:"[^\\n]"},rt={type:"other",description:"identifier"},it=/^[a-z_]/i,ot={type:"class",value:"[a-z_]i",description:"[a-z_]i"},ct=/^[a-z0-9_\-]/i,st={type:"class",value:"[a-z0-9_\\-]i",description:"[a-z0-9_\\-]i"},ut=function(e,t){return e+t.join("")},at={type:"other",description:"dotted path"},lt=".",ft={type:"literal",value:".",description:'"."'},dt=function(e,t){return t.length?[e].concat(t.map(function(e){return e[1]})):[e]},pt="!",ht={type:"literal",value:"!",description:'"!"'},vt=function(e){return e},mt="#",gt={type:"literal",value:"#",description:'"#"'},yt=function(e){return{id:e}},Ct=function(e){return{className:e}},xt=/^[^\\\n\]]/,At={type:"class",value:"[^\\\\\\n\\]]",description:"[^\\\\\\n\\]]"},wt=function(e){return e.join("")},$t="[",Et={type:"literal",value:"[",description:'"["'},Nt="=",bt={type:"literal",value:"=",description:'"="'},St="]",jt={type:"literal",value:"]",description:'"]"'},Ot=function(e,t){return{attr:e,value:t}},Tt=function(e,t){return{prop:e,value:t}},kt=function(e,t){return{event:e,value:t}},_t={type:"other",description:"element qualifier"},Ft={type:"other",description:"element"},Rt=function(t,n){return e.createElement("div",t,n,r())},Dt=function(t,n,i){return e.createElement(t,n,i,r())},zt=function(e){return e},Pt=function(e){return e},qt=function(e,t){return{textnode:e,partial:t}},Lt={type:"other",description:"text node"},Ht=function(t){return e.createTextNode(t,r())},Jt="u",Mt={type:"literal",value:"u",description:'"u"'},Ut=/^[0-9a-z]/i,Vt={type:"class",value:"[0-9a-z]i",description:"[0-9a-z]i"},Bt=function(e,t,n,r){return""+e+t+n+r},It="x",Wt={type:"literal",value:"x",description:'"x"'},Gt=function(e,t){return""+e+t},Xt="\\",Kt={type:"literal",value:"\\",description:'"\\\\"'},Qt=function(t){return e.escapedCharacter(t)},Yt='"',Zt={type:"literal",value:'"',description:'"\\""'},en=/^[^\\\n"]/,tn={type:"class",value:'[^\\\\\\n"]',description:'[^\\\\\\n"]'},nn="'",rn={type:"literal",value:"'",description:'"\'"'},on=/^[^\\\n']/,cn={type:"class",value:"[^\\\\\\n']",description:"[^\\\\\\n']"},sn={type:"other",description:"quoted text"},un={type:"other",description:"directive"},an="@",ln={type:"literal",value:"@",description:'"@"'},fn=function(t){return e.createDirective(t,void 0,r())},dn=function(t,n){return e.createDirective(t,n.join(""),r())},pn=0,hn=0,vn=0,mn={line:1,column:1,seenCR:!1},gn=0,yn=[],Cn=0;if("startRule"in q){if(!(q.startRule in H))throw new Error("Can't start parsing from rule \""+q.startRule+'".');J=H[q.startRule]}var xn=[0];if(P=J(),P!==L&&pn===t.length)return P;throw P!==L&&pn<t.length&&o({type:"end",description:"end of input"}),c(null,yn,gn)}return t(n,Error),{SyntaxError:n,parse:r}}()}(l),d=function(){var e,t,n=/\r\n|\r|\n/,r=/^[ \t]*$/,i=/\/\*((?:\/(?!<\*)|[^\/])*?)\*\//g;return e=function(e,t){return t.split(n).map(function(){return""}).join("\n")},t=function(e){return e.match(r)?"":e},function(r){return r.replace(i,e).split(n).map(t).reduce(function(e,t){if(e.length){var n=e[e.length-1];"\\"===n[n.length-1]?e[e.length-1]=n.replace(/\s*\\$/,"")+t.replace(/^\s*/,""):e.push(t)}else e.push(t);return e},[]).join("\n")}}(),p=function(e){function t(e){return"new ist.Template("+JSON.stringify(e.name)+", "+JSON.stringify(e.nodes)+")"}function i(i){var o,c={};if(r)o=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState){if(200!==n.status)throw new Error("HTTP status "+n.status+" when loading "+e);t(n.responseText)}},n.send(null)};else if(n){var s=require.nodeRequire("fs");o=function(e,t){var n=s.readFileSync(e,"utf8");0===n.indexOf("﻿")&&(n=n.substring(1)),t(n)}}i.write=function(e,t,n){var r="ist!"+t;if(c.hasOwnProperty(r)){var i=c[r];n(i)}},i.load=function(n,r,s,u){var a,l;a=r.toUrl(n+".ist"),l=-1===n.indexOf("/")?".":n.replace(/\/[^\/]*$/,""),o(a,function(o){var f,d=["ist"];o=o.replace(/^(\s*)@include\s+(?:text=)?(['"])((?:(?=(\\?))\4.)*?)\2/gm,function(t,n,r,i){if(e.findScript(i))return t;var o=l+"/"+i.replace(/\.ist$/,"");return-1===d.indexOf("ist!"+o)&&d.push("ist!"+o),n+'@include "'+o+'"'}),f=t(i(o,n)),o="define('ist!"+n+"',"+JSON.stringify(d)+", function(ist) {\n  return "+f+";\n});\n",u.isBuild&&(c["ist!"+n]=o),u.isBuild||(o+="\r\n//@ sourceURL="+a),s.fromText("ist!"+n,o),r(["ist!"+n],function(e){s(e)})})}}return i}(i),h=function(e,i,o,c,s,u,a){function l(t,n){var r;n=n||"<unknown>";try{r=c.parse(s(t))}catch(i){throw i.message+=" in '"+n+"' on line "+i.line+("undefined"!=typeof i.column?", character "+i.column:""),i}return new e(n,r)}return l.Template=e,l.fromScriptTag=function(e){return console&&(console.warn||console.log)("Warning: ist.fromScriptTag is deprecated, use ist.script instead"),l.script(e)},l.registerHelper=function(e,t){console&&(console.warn||console.log)("Warning: ist.registerHelper is deprecated, use ist.helper instead"),l.helper(e,t)},l.createNode=function(e,t,n){return console&&(console.warn||console.log)("Warning: ist.createNode is deprecated, use ist.create instead"),l.create(e,t,n)},l.create=function(e,t,n){var r,i=e.split(">").map(function(e){return e.trim()}),o="",c="";return i.forEach(function(e){c+="\n"+o+e,o+=" "}),r=l(c).render(t,n),1===r.childNodes.length?r.firstChild:r},l.script=function(e){var t=a.findScript(e);return t?l(t):void 0},l.helper=function(e,t){i.register(e,t)},l.helper("include",function(e,n,r,i){i(function(r,i){if(!i){var o,c,s=n,u=s.replace(/\.ist$/,"");if(o=a.findScript(s),t)for(c=[u,u+".ist","ist!"+u,"text!"+u+".ist"];!o&&c.length;)try{o=requirejs(c.shift())}catch(f){}if(!o)throw new Error("Cannot find included template '"+s+"'");if("string"==typeof o&&(o=l(o,u)),"function"==typeof o.render)return o.render(e);throw new Error("Invalid included template '"+s+"'")}i.update(e)})}),l.global=function(e,t){o.globalScope[e]=t},(n||r&&t)&&u(l),l}(a,u,s,f,d,p,i);if(t||n)define("ist",[],function(){return h});else{var v=e.ist;e.ist=h,e.ist.noConflict=function(){var t=e.ist;return e.ist=v,t}}}(this);