/** @license
 * IST: Indented Selector Templating
 * version 0.5
 *
 * Copyright (c) 2012 Nicolas Joyard
 * Released under the MIT license.
 *
 * Author: Nicolas Joyard <joyard.nicolas@gmail.com>
 * http://github.com/k-o-x/ist
 */define(function(){"use strict";var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d={},v=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],m=[];return Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),i=function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},r=function(e,t,n){t.prototype=new e,Object.keys(n).forEach(function(e){t.prototype[e]=n[e]})},a=function(e,t){this.value=e,this.doc=t||document},a.prototype={createDocumentFragment:function(){return this.doc.createDocumentFragment()},createElement:function(e,t){return typeof t!="undefined"?this.doc.createElementNS(t,e):this.doc.createElement(e)},createTextNode:function(e){return this.doc.createTextNode(this.interpolate(e))},getPath:function(e){var t;e=e.trim();if(e==="this")return this.value;t=function(e,n){var r=n[e.shift()];return e.length>0?t(e,r):r};try{return t(e.split("."),this.value)}catch(n){throw new Error("Cannot find path "+e+" in context")}},interpolate:function(e){return e.replace(/{{(.*?)}}/g,function(e,t){return this.getPath(t)}.bind(this))},createContext:function(e){return new a(e,this.doc)},getSubcontext:function(e){return this.createContext(this.getPath(e))}},f=function(){},f.prototype={render:function(e,t){return e instanceof a||(e=new a(e,t)),this._render(e)},_render:function(e){throw new Error("Cannot render base Node")}},h=function(e){this.text=e},r(f,h,{_render:function(e){return e.createTextNode(this.text)},appendChild:function(e){throw new Error("Cannot add children to TextNode")}}),l=function(){},r(f,l,{appendChild:function(e){this.children=this.children||[],this.children.push(e)},_render:function(e){var t=e.createDocumentFragment();return this.children=this.children||[],this.children.forEach(function(n){t.appendChild(n._render(e))}),t}}),p=function(e){this.tagName=e,this.attributes={},this.properties={},this.classes=[],this.id=undefined},r(l,p,{setAttribute:function(e,t){this.attributes[e]=t},setProperty:function(e,t){this.properties[e]=t},setClass:function(e){this.classes.push(e)},setId:function(e){this.id=e},_render:function(e){var t=this,n=e.createElement(this.tagName);return n.appendChild(l.prototype._render.call(this,e)),Object.keys(this.attributes).forEach(function(r){var i=e.interpolate(t.attributes[r]);n.setAttribute(r,i)}),Object.keys(this.properties).forEach(function(r){var i=e.interpolate(t.properties[r]);n[r]=i}),this.classes.forEach(function(e){n.classList.add(e)}),typeof this.id!="undefined"&&(n.id=this.id),n}}),c=function(e,t,n){this.name=e,this.path=t,this.value=n},r(l,c,{_render:function(e){var t=this,n={},r,i;if(typeof d[this.name]!="function")throw new Error("No block helper for @"+this.name+" has been registered");return typeof this.path!="undefined"?r=e.getSubcontext(this.path):typeof this.value!="undefined"&&(r=e.createContext(this.value)),n.render=l.prototype.render.bind(n),n._render=l.prototype._render.bind(t),i=d[this.name].call(e,r,n),typeof i=="undefined"?e.createDocumentFragment():i}}),t=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var t={parse:function(t,n){function a(e,t,n){var r=e,i=n-e.length;for(var s=0;s<i;s++)r=t+r;return r}function f(e){var t=e.charCodeAt(0),n,r;return t<=255?(n="x",r=2):(n="u",r=4),"\\"+n+a(t.toString(16).toUpperCase(),"0",r)}function d(e){var t={};for(var n in e)t[n]=e[n];return t}function v(e,n){var r=e.offset+n;for(var i=e.offset;i<r;i++){var s=t.charAt(i);s==="\n"?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):s==="\r"||s==="\u2028"||s==="\u2029"?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}e.offset+=n}function m(e){if(i.offset<o.offset)return;i.offset>o.offset&&(o=d(i),u=[]),u.push(e)}function g(){var e,t,n,r,s,o,u,a;o=d(i),u=d(i),e=[],t=E();while(t!==null)e.push(t),t=E();if(e!==null){t=y(),t=t!==null?t:"";if(t!==null){n=[],a=d(i),s=E();if(s!==null){r=[];while(s!==null)r.push(s),s=E()}else r=null;r!==null?(s=y(),s!==null?r=[r,s]:(r=null,i=d(a))):(r=null,i=d(a));while(r!==null){n.push(r),a=d(i),s=E();if(s!==null){r=[];while(s!==null)r.push(s),s=E()}else r=null;r!==null?(s=y(),s!==null?r=[r,s]:(r=null,i=d(a))):(r=null,i=d(a))}if(n!==null){r=[],s=E();while(s!==null)r.push(s),s=E();r!==null?e=[e,t,n,r]:(e=null,i=d(u))}else e=null,i=d(u)}else e=null,i=d(u)}else e=null,i=d(u);return e!==null&&(e=function(e,t,n,r,i){return Q(r,i)}(o.offset,o.line,o.column,e[1],e[2])),e===null&&(i=d(o)),e}function y(){var e,n,r,o,u,a;u=d(i),a=d(i),e=w();if(e!==null){n=A(),n===null&&(n=_(),n===null&&(n=q()));if(n!==null){r=[],/^[ \t]/.test(t.charAt(i.offset))?(o=t.charAt(i.offset),v(i,1)):(o=null,s===0&&m("[ \\t]"));while(o!==null)r.push(o),/^[ \t]/.test(t.charAt(i.offset))?(o=t.charAt(i.offset),v(i,1)):(o=null,s===0&&m("[ \\t]"));r!==null?e=[e,n,r]:(e=null,i=d(a))}else e=null,i=d(a)}else e=null,i=d(a);return e!==null&&(e=function(e,t,n,r,i){return{indent:r,item:i,num:t}}(u.offset,u.line,u.column,e[0],e[1])),e===null&&(i=d(u)),e}function b(){var e;return s++,/^[ \t]/.test(t.charAt(i.offset))?(e=t.charAt(i.offset),v(i,1)):(e=null,s===0&&m("[ \\t]")),s--,s===0&&e===null&&m("whitespace"),e}function w(){var e,t,n;s++,n=d(i),e=[],t=b();while(t!==null)e.push(t),t=b();return e!==null&&(e=function(e,t,n,r){return G(r,t)}(n.offset,n.line,n.column,e)),e===null&&(i=d(n)),s--,s===0&&e===null&&m("indent"),e}function E(){var e;return s++,t.charCodeAt(i.offset)===10?(e="\n",v(i,1)):(e=null,s===0&&m('"\\n"')),s--,s===0&&e===null&&m("new line"),e}function S(){var e;return s++,/^[^\n]/.test(t.charAt(i.offset))?(e=t.charAt(i.offset),v(i,1)):(e=null,s===0&&m("[^\\n]")),s--,s===0&&e===null&&m("character"),e}function x(){var e,n,r,o,u;s++,o=d(i),u=d(i),/^[a-z_]/i.test(t.charAt(i.offset))?(e=t.charAt(i.offset),v(i,1)):(e=null,s===0&&m("[a-z_]i"));if(e!==null){n=[],/^[a-z0-9_\-]/i.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[a-z0-9_\\-]i"));while(r!==null)n.push(r),/^[a-z0-9_\-]/i.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[a-z0-9_\\-]i"));n!==null?e=[e,n]:(e=null,i=d(u))}else e=null,i=d(u);return e!==null&&(e=function(e,t,n,r,i){return r+i.join("")}(o.offset,o.line,o.column,e[0],e[1])),e===null&&(i=d(o)),s--,s===0&&e===null&&m("identifier"),e}function T(){var e,n,r,o;return r=d(i),o=d(i),t.charCodeAt(i.offset)===35?(e="#",v(i,1)):(e=null,s===0&&m('"#"')),e!==null?(n=x(),n!==null?e=[e,n]:(e=null,i=d(o))):(e=null,i=d(o)),e!==null&&(e=function(e,t,n,r){return{id:r}}(r.offset,r.line,r.column,e[1])),e===null&&(i=d(r)),e}function N(){var e,n,r,o;return r=d(i),o=d(i),t.charCodeAt(i.offset)===46?(e=".",v(i,1)):(e=null,s===0&&m('"."')),e!==null?(n=x(),n!==null?e=[e,n]:(e=null,i=d(o))):(e=null,i=d(o)),e!==null&&(e=function(e,t,n,r){return{className:r}}(r.offset,r.line,r.column,e[1])),e===null&&(i=d(r)),e}function C(){var e,n,r,o,u,a,f;a=d(i),f=d(i),t.charCodeAt(i.offset)===91?(e="[",v(i,1)):(e=null,s===0&&m('"["'));if(e!==null){n=x();if(n!==null){t.charCodeAt(i.offset)===61?(r="=",v(i,1)):(r=null,s===0&&m('"="'));if(r!==null){o=[],/^[^\n\]]/.test(t.charAt(i.offset))?(u=t.charAt(i.offset),v(i,1)):(u=null,s===0&&m("[^\\n\\]]"));while(u!==null)o.push(u),/^[^\n\]]/.test(t.charAt(i.offset))?(u=t.charAt(i.offset),v(i,1)):(u=null,s===0&&m("[^\\n\\]]"));o!==null?(t.charCodeAt(i.offset)===93?(u="]",v(i,1)):(u=null,s===0&&m('"]"')),u!==null?e=[e,n,r,o,u]:(e=null,i=d(f))):(e=null,i=d(f))}else e=null,i=d(f)}else e=null,i=d(f)}else e=null,i=d(f);return e!==null&&(e=function(e,t,n,r,i){return{attr:r,value:i.join("")}}(a.offset,a.line,a.column,e[1],e[3])),e===null&&(i=d(a)),e}function k(){var e,n,r,o,u,a,f,l;f=d(i),l=d(i),t.charCodeAt(i.offset)===91?(e="[",v(i,1)):(e=null,s===0&&m('"["'));if(e!==null){t.charCodeAt(i.offset)===46?(n=".",v(i,1)):(n=null,s===0&&m('"."'));if(n!==null){r=x();if(r!==null){t.charCodeAt(i.offset)===61?(o="=",v(i,1)):(o=null,s===0&&m('"="'));if(o!==null){u=[],/^[^\n\]]/.test(t.charAt(i.offset))?(a=t.charAt(i.offset),v(i,1)):(a=null,s===0&&m("[^\\n\\]]"));while(a!==null)u.push(a),/^[^\n\]]/.test(t.charAt(i.offset))?(a=t.charAt(i.offset),v(i,1)):(a=null,s===0&&m("[^\\n\\]]"));u!==null?(t.charCodeAt(i.offset)===93?(a="]",v(i,1)):(a=null,s===0&&m('"]"')),a!==null?e=[e,n,r,o,u,a]:(e=null,i=d(l))):(e=null,i=d(l))}else e=null,i=d(l)}else e=null,i=d(l)}else e=null,i=d(l)}else e=null,i=d(l);return e!==null&&(e=function(e,t,n,r,i){return{prop:r,value:i.join("")}}(f.offset,f.line,f.column,e[2],e[4])),e===null&&(i=d(f)),e}function L(){var e;return s++,e=T(),e===null&&(e=N(),e===null&&(e=C(),e===null&&(e=k()))),s--,s===0&&e===null&&m("element qualifier"),e}function A(){var e;return s++,e=O(),e===null&&(e=M()),s--,s===0&&e===null&&m("element"),e}function O(){var e,t,n;n=d(i),t=L();if(t!==null){e=[];while(t!==null)e.push(t),t=L()}else e=null;return e!==null&&(e=function(e,t,n,r){return et("div",r)}(n.offset,n.line,n.column,e)),e===null&&(i=d(n)),e}function M(){var e,t,n,r,s;r=d(i),s=d(i),e=x();if(e!==null){t=[],n=L();while(n!==null)t.push(n),n=L();t!==null?e=[e,t]:(e=null,i=d(s))}else e=null,i=d(s);return e!==null&&(e=function(e,t,n,r,i){return et(r,i)}(r.offset,r.line,r.column,e[0],e[1])),e===null&&(i=d(r)),e}function _(){var e,t;return s++,t=d(i),e=I(),e!==null&&(e=function(e,t,n,r){return Z(r)}(t.offset,t.line,t.column,e)),e===null&&(i=d(t)),s--,s===0&&e===null&&m("text node"),e}function D(){var e,n,r,o,u,a,f,l;s++,u=d(i),a=d(i),e=x();if(e!==null){n=[],f=d(i),l=d(i),t.charCodeAt(i.offset)===46?(r=".",v(i,1)):(r=null,s===0&&m('"."')),r!==null?(o=x(),o!==null?r=[r,o]:(r=null,i=d(l))):(r=null,i=d(l)),r!==null&&(r=function(e,t,n,r){return r}(f.offset,f.line,f.column,r[1])),r===null&&(i=d(f));while(r!==null)n.push(r),f=d(i),l=d(i),t.charCodeAt(i.offset)===46?(r=".",v(i,1)):(r=null,s===0&&m('"."')),r!==null?(o=x(),o!==null?r=[r,o]:(r=null,i=d(l))):(r=null,i=d(l)),r!==null&&(r=function(e,t,n,r){return r}(f.offset,f.line,f.column,r[1])),r===null&&(i=d(f));n!==null?e=[e,n]:(e=null,i=d(a))}else e=null,i=d(a);return e!==null&&(e=function(e,t,n,r,i){return i.unshift(r),i.join(".")}(u.offset,u.line,u.column,e[0],e[1])),e===null&&(i=d(u)),s--,s===0&&e===null&&m("context property path"),e}function P(){var e,n,r,o,u,a,f;return a=d(i),f=d(i),t.charCodeAt(i.offset)===117?(e="u",v(i,1)):(e=null,s===0&&m('"u"')),e!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(n=t.charAt(i.offset),v(i,1)):(n=null,s===0&&m("[0-9a-z]i")),n!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[0-9a-z]i")),r!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(o=t.charAt(i.offset),v(i,1)):(o=null,s===0&&m("[0-9a-z]i")),o!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(u=t.charAt(i.offset),v(i,1)):(u=null,s===0&&m("[0-9a-z]i")),u!==null?e=[e,n,r,o,u]:(e=null,i=d(f))):(e=null,i=d(f))):(e=null,i=d(f))):(e=null,i=d(f))):(e=null,i=d(f)),e!==null&&(e=function(e,t,n,r,i,s,o){return""+r+i+s+o}(a.offset,a.line,a.column,e[1],e[2],e[3],e[4])),e===null&&(i=d(a)),e}function H(){var e,n,r,o,u;return o=d(i),u=d(i),t.charCodeAt(i.offset)===120?(e="x",v(i,1)):(e=null,s===0&&m('"x"')),e!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(n=t.charAt(i.offset),v(i,1)):(n=null,s===0&&m("[0-9a-z]i")),n!==null?(/^[0-9a-z]/i.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[0-9a-z]i")),r!==null?e=[e,n,r]:(e=null,i=d(u))):(e=null,i=d(u))):(e=null,i=d(u)),e!==null&&(e=function(e,t,n,r,i){return""+r+i}(o.offset,o.line,o.column,e[1],e[2])),e===null&&(i=d(o)),e}function B(){var e,n,r,o;return r=d(i),o=d(i),t.charCodeAt(i.offset)===92?(e="\\",v(i,1)):(e=null,s===0&&m('"\\\\"')),e!==null?(n=P(),n===null&&(n=H(),n===null&&(n=S())),n!==null?e=[e,n]:(e=null,i=d(o))):(e=null,i=d(o)),e!==null&&(e=function(e,t,n,r){return Y(r)}(r.offset,r.line,r.column,e[1])),e===null&&(i=d(r)),e}function j(){var e,n,r,o,u;o=d(i),u=d(i),t.charCodeAt(i.offset)===34?(e='"',v(i,1)):(e=null,s===0&&m('"\\""'));if(e!==null){n=[],r=B(),r===null&&(/^[^\\\n"]/.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m('[^\\\\\\n"]')));while(r!==null)n.push(r),r=B(),r===null&&(/^[^\\\n"]/.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m('[^\\\\\\n"]')));n!==null?(t.charCodeAt(i.offset)===34?(r='"',v(i,1)):(r=null,s===0&&m('"\\""')),r!==null?e=[e,n,r]:(e=null,i=d(u))):(e=null,i=d(u))}else e=null,i=d(u);return e!==null&&(e=function(e,t,n,r){return r.join("")}(o.offset,o.line,o.column,e[1])),e===null&&(i=d(o)),e}function F(){var e,n,r,o,u;o=d(i),u=d(i),t.charCodeAt(i.offset)===39?(e="'",v(i,1)):(e=null,s===0&&m('"\'"'));if(e!==null){n=[],r=B(),r===null&&(/^[^\\\n']/.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[^\\\\\\n']")));while(r!==null)n.push(r),r=B(),r===null&&(/^[^\\\n']/.test(t.charAt(i.offset))?(r=t.charAt(i.offset),v(i,1)):(r=null,s===0&&m("[^\\\\\\n']")));n!==null?(t.charCodeAt(i.offset)===39?(r="'",v(i,1)):(r=null,s===0&&m('"\'"')),r!==null?e=[e,n,r]:(e=null,i=d(u))):(e=null,i=d(u))}else e=null,i=d(u);return e!==null&&(e=function(e,t,n,r){return r.join("")}(o.offset,o.line,o.column,e[1])),e===null&&(i=d(o)),e}function I(){var e;return s++,e=j(),e===null&&(e=F()),s--,s===0&&e===null&&m("quoted text"),e}function q(){var e;return s++,e=z(),e===null&&(e=U(),e===null&&(e=R())),s--,s===0&&e===null&&m("directive"),e}function R(){var e,n,r,o;return r=d(i),o=d(i),t.charCodeAt(i.offset)===64?(e="@",v(i,1)):(e=null,s===0&&m('"@"')),e!==null?(n=x(),n!==null?e=[e,n]:(e=null,i=d(o))):(e=null,i=d(o)),e!==null&&(e=function(e,t,n,r){return tt(r)}(r.offset,r.line,r.column,e[1])),e===null&&(i=d(r)),e}function U(){var e,n,r,o,u,a;return u=d(i),a=d(i),t.charCodeAt(i.offset)===64?(e="@",v(i,1)):(e=null,s===0&&m('"@"')),e!==null?(n=x(),n!==null?(r=b(),r!==null?(o=D(),o!==null?e=[e,n,r,o]:(e=null,i=d(a))):(e=null,i=d(a))):(e=null,i=d(a))):(e=null,i=d(a)),e!==null&&(e=function(e,t,n,r,i){return tt(r,i)}(u.offset,u.line,u.column,e[1],e[3])),e===null&&(i=d(u)),e}function z(){var e,n,r,o,u,a;return u=d(i),a=d(i),t.charCodeAt(i.offset)===64?(e="@",v(i,1)):(e=null,s===0&&m('"@"')),e!==null?(n=x(),n!==null?(r=b(),r!==null?(o=I(),o!==null?e=[e,n,r,o]:(e=null,i=d(a))):(e=null,i=d(a))):(e=null,i=d(a))):(e=null,i=d(a)),e!==null&&(e=function(e,t,n,r,i){return tt(r,undefined,i)}(u.offset,u.line,u.column,e[1],e[3])),e===null&&(i=d(u)),e}function W(e){e.sort();var t=null,n=[];for(var r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}var r={templateLines:g,line:y,__:b,indent:w,newline:E,character:S,identifier:x,elemId:T,elemClass:N,elemAttribute:C,elemProperty:k,elemQualifier:L,element:A,implicitElement:O,explicitElement:M,textNode:_,contextPath:D,escapedUnicode:P,escapedASCII:H,escapedCharacter:B,doubleQuotedText:j,singleQuotedText:F,quotedText:I,directive:q,simpleDirective:R,pathDirective:U,valueDirective:z};if(n!==undefined){if(r[n]===undefined)throw new Error("Invalid rule name: "+e(n)+".")}else n="templateLines";var i={offset:0,line:1,column:1,seenCR:!1},s=0,o={offset:0,line:1,column:1,seenCR:!1},u=[],X="U",V="I",$="D",J,K=[0],Q,G,Y,Z,et,tt;Q=function(e,t){var n=[new l],r=0,i,s,o,u;if(!e)return n[0];s=function(){return n[n.length-1]},o=function(e){r++,n.push(e)},u=function(e){var t;if(n.length<2)throw new Error("Could not pop node from stack");return t=n.pop(),s().appendChild(t),t},i=t.map(function(e){return e.pop()}),i.unshift(e),i.forEach(function(e,t){var n=e.indent,i=e.item,a=e.num,f;if(n[0]instanceof Error)throw n[0];if(r>0)if(n[0]===X)u();else if(n[0]===$){u();while(n.length>0)n.pop(),u()}else if(n[0]===V&&s()instanceof h)throw f=new Error("Cannot add children to text node"),f.line=a,f;o(i)});while(n.length>1)u();return s()},G=function(e,t){var n=e.length,r=[],i;n.length===0&&K.push(n);if(n==K[0])return[X];if(n>K[0])return K.unshift(n),[V];while(n<K[0])K.shift(),r.push($);return n!=K[0]?(i=new Error("Unexpected indent"),i.line=t,i.column=1,[i]):r},Z=function(e){return new h(e)},et=function(e,t){var n=new p(e);return t.forEach(function(e){typeof e.id!="undefined"?n.setId(e.id):typeof e.className!="undefined"?n.setClass(e.className):typeof e.attr!="undefined"?n.setAttribute(e.attr,e.value):typeof e.prop!="undefined"&&n.setProperty(e.prop,e.value)}),n},tt=function(e,t,n){return new c(e,t,n)},Y=function(e){return e.length>1?String.fromCharCode(parseInt(e,16)):{f:"\f",b:"\b",t:"	",n:"\n",r:"\r"}[e]||e};var nt=r[n]();if(nt===null||i.offset!==t.length){var rt=Math.max(i.offset,o.offset),it=rt<t.length?t.charAt(rt):null,st=i.offset>o.offset?i:o;throw new this.SyntaxError(W(u),it,rt,st.line,st.column)}return nt},toSource:function(){return this._source}};return t.SyntaxError=function(t,n,r,i,s){function o(t,n){var r,i;switch(t.length){case 0:r="end of input";break;case 1:r=t[0];break;default:r=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return i=n?e(n):"end of input","Expected "+r+" but "+i+" found."}this.name="SyntaxError",this.expected=t,this.found=n,this.message=o(t,n),this.offset=r,this.line=i,this.column=s},t.SyntaxError.prototype=Error.prototype,t}(),s=function(e){var t=/\r\n|\r|\n/,n=/^[ \t]*$/,r=/\/\*((?:\/(?!<\*)|[^\/])*?)\*\//g,i=e.split(t);return i.forEach(function(e,t){e.match(n)&&(i[t]="")}),e=i.join("\n"),e=e.replace(r,function(e,n){return n.split(t).map(function(e){return""}).join("\n")}),e},e=function(e,n){var r;n=n||"<unknown>";try{r=t.parse(s(e))}catch(i){throw new Error("In "+n+" on line "+i.line+(typeof i.column!="undefined"?", character "+i.column:"")+": "+i.message)}return r},e.createNode=function(t,n,r){var i=t.split(">").map(function(e){return e.trim()}),s="",o="",u;return i.forEach(function(e){o+="\n"+s+e,s+=" "}),u=e(o).render(n,r),u.childNodes.length===1?u.firstChild:u},e.registerHelper=function(e,t){d[e]=t},e.registerHelper("if",function(e,t){if(e.value)return t.render(this)}),e.registerHelper("unless",function(e,t){if(!e.value)return t.render(this)}),e.registerHelper("with",function(e,t){return t.render(e)}),e.registerHelper("each",function(e,t){var n=this.createDocumentFragment(),r=this.value,i=e.value;return i&&Array.isArray(i)&&i.forEach(function(s,o){var u;s===null||typeof s!="object"&&!Array.isArray(s)?u={toString:function(){return s.toString()},loop:{first:o==0,index:o,last:o==i.length-1,length:i.length,outer:r}}:(u=s,s.loop={first:o==0,index:o,last:o==i.length-1,length:i.length,outer:r}),n.appendChild(t.render(e.createContext(u))),u===s&&delete s.loop}),n}),e.registerHelper("include",function(t,n){var r=t.value.replace(/\.ist$/,""),i,s;s=[r,r+".ist","ist!"+r,"text!"+r+".ist"];while(!i&&s.length)try{i=requirejs(s.shift())}catch(o){if(s.length===0)throw new Error("Cannot find included template '"+r+"'")}typeof i=="string"&&(i=e(i,r));if(typeof i.render=="function")return i.render(this,n.document);throw new Error("Invalid included template '"+r+"'")}),typeof window!="undefined"&&window.navigator&&window.document?(o=function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(t=0;t<3;t++){n=v[t];try{e=new ActiveXObject(n)}catch(r){}if(e){v=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},u=function(e,t){var n=o();n.open("GET",e,!0),n.onreadystatechange=function(r){if(n.readyState===4){if(n.status!==200)throw new Error("HTTP status "+n.status+" when loading "+e);t(n.responseText)}},n.send(null)}):typeof process!="undefined"&&process.versions&&!!process.versions.node&&(n=require.nodeRequire("fs"),u=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)}),e.write=function(e,t,n){var r="ist!"+t;if(m.hasOwnProperty(r)){var i=m[r];n(i)}},e.load=function(e,t,n,r){var s=t.toUrl(e+".ist"),o=e.indexOf("/")===-1?".":e.replace(/\/[^\/]*$/,"");u(s,function(u){var a,f,l=["ist"];u=u.replace(/^(\s*)@include\s+(?:text=)?(['"])((?:(?=(\\?))\4.)*?)\2/gm,function(e,t,n,r){var i=o+"/"+r.replace(/\.ist$/,"");return l.indexOf("ist!"+i)===-1&&l.push("ist!"+i),t+'@include "'+i+'"'}),r.isBuild?(u=i(u),u="define('ist!"+e+"',"+JSON.stringify(l)+",function(ist){"+"var template='"+u+"';"+"return ist(template,'"+e+"');"+"});"):(u=i(u).replace(/\\n/g,"\\n' +\n	               '"),u="define('ist!"+e+"',"+JSON.stringify(l)+", function(ist){ \n"+"	var template = '"+u+"';\n"+"	return ist(template, '"+e+"');\n"+"});\n"),r.isBuild&&(m["ist!"+e]=u),r.isBuild||(u+="\r\n//@ sourceURL="+s),n.fromText("ist!"+e,u),t(["ist!"+e],function(e){n(e)})})},e});