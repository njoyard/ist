<!DOCTYPE html>
<html>
<head>
    <title>IST test runner</title>
    <link rel="stylesheet" href="lib/jasmine/jasmine.css">
</head>
<body>
	<script type="text/x-ist" id="scriptTag">
		div.insideScriptTag
			div.child
				@if variable === "value"
					div.conditional
	</script>
	
	<!--[if IE 8]>
	<script src="shims/classList.min.js"></script>
	<script src="shims/augment.min.js"></script>
	<script src="shims/importNode.js"></script>
	<![endif]-->

    <script src="lib/jasmine/jasmine.js"></script>
    <script src="lib/jasmine/jasmine-html.js"></script>
    <script src="lib/requirejs/require.js"></script>
    
    <script>
        require({
            baseUrl: 'spec',
            paths: {
            	'text': '../lib/requirejs/text',
            	'order': '../lib/requirejs/order',
            	'ist': '../../ist'
            },
            waitSeconds: 3600
        });

        require(
            [
            	'ist',
            	'nodetypes', 'qualifiers', 'syntax', 'interpolation', 'builtins',
            	'directivehelper', 'createnode', 'update', 'usage'
            ],
            function(ist, nodetypes, qualifiers, syntax, interpolation, builtins,
            	directivehelper, createnode, update, usage){
            	/* IST specific matchers */
				beforeEach(function() {
					var matchers = {};
		
					matchers.toThrowAny = function(messages) {
						var thrown;
						
						this.message = function() {
							var actual;
							
							if (thrown) {
								actual = "it threw '" + thrown + "'";
							} else {
								actual = "it didn't throw any exception";
							}
							
							return "Expected function to throw any of " + messages.map(function(m) { return "'" + m + "'"; }).join(", ") + " but " + actual;
						};
						
						try {
							this.actual();
						} catch(e) {
							thrown = e.message || e;
						}
						
						return typeof thrown !== 'undefined' && messages.indexOf(thrown) != -1;
					},
		
					matchers.toParse = function() {
						var template = this.actual,
							err;
				
						this.message = function() {
							return "Expected successful parsing but caught \"" + err.message + "\"";
						};
					
						try {
							ist(template);
						} catch (e) {
							err = e;
						}
					
						return typeof err === 'undefined';
					};
				
					matchers.toFailParse = function(message) {
						var template = this.actual,
							err;
					
						this.message = function() {
							var actual;
						
							if (typeof err === "undefined") {
								actual = "parsing succeeded";
							} else {
								actual = "caught \"" + err.message + "\" instead";
							}
						
							return "Expected parse failure \"" + message + "\" but " + actual;
						};
					
						try {
							ist(template);
						} catch (e) {
							err = e;
						}
					
						return typeof err !== 'undefined' && err.message === message;
					};
		
					matchers.toRender = function(context) {
						var template = this.actual,
							err;
					
						this.message = function() {
							return "Expected successful rendering but caught \"" + err.message + "\"";
						};
					
						try {
							template.render(context);
						} catch (e) {
							err = e;
						}
					
						return typeof err === 'undefined';
					};
		
					matchers.toFailRender = function(context) {
						var template = this.actual,
							err;
					
						this.message = function() {
							var actual;
						
							if (typeof err === "undefined") {
								actual = "rendering succeeded";
							} else {
								actual = "caught \"" + err.message + "\" instead";
							}
						
							return "Expected render failure \"" + message + "\" but " + actual;
						};
					
						try {
							template.render(context);
						} catch (e) {
							err = e;
						}
					
						return typeof err !== 'undefined' && err.message === message;
					};
					
					matchers.toBeInDocument = function(doc) {
						var actual = this.actual.ownerDocument;
						
						this.message = function() {
							return "Unexpected owner document";
						};
						
						return actual === doc;
					};
				
					matchers.toHaveNodeType = function(nodeType) {
						var actual = this.actual.nodeType;
					
						this.message = function() {
							return "Expected node type " + nodeType + " instead of " + actual;
						};
					
						return actual === nodeType;
					};
				
					matchers.toBeElement = function(tagName) {
						var actual = this.actual.tagName;
						
						this.message = function() {
							return "Expected <" + tagName + "> element instead of <" + actual + ">";
						};
					
						return actual.toLowerCase() === tagName.toLowerCase();
					};
				
					matchers.toHaveTextContent = function(textContent) {
						var actual = this.actual.textContent;
						
						this.message = function() {
							return "Expected text content \"" + textContent + "\" instead of \"" + actual + "\"";
						};
					
						return actual === textContent;
					};
					
					matchers.toBeSameNodeAs = function(node) {
						var actual = this.actual;
						
						this.message = function() {
							return "Expected " + actual + " to be same node as " + node;
						};
						
						return actual.isSameNode(node);
					};
			
					this.addMatchers(matchers);
				});
            
            	/* Describe tests */
            	describe('usage', usage);
            	describe('nodetypes', nodetypes);
            	describe('qualifiers', qualifiers);
            	describe('syntax', syntax);
            	describe('interpolation', interpolation);
            	describe('directivehelper', directivehelper);
            	describe('builtins', builtins);
            	describe('createnode', createnode);
            	describe('update', update);
            
            	/* Run Jasmine */
                jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
                jasmine.getEnv().execute();
            }
        );
    </script>
</body>
</html>
